% Final thing is style report, not article.
\documentclass[12pt,a4paper]{report}

\usepackage{algpseudocode}
\usepackage{color}
\usepackage{amsmath}
\usepackage{tikz}
\usepackage{tabularx}
\usepackage{rotating}
\usepackage{subfigure}
\usepackage{amssymb}
\usepackage{paralist}
\usepackage{multirow}

\newbox\subfigbox             % Create a box to hold the subfigure.
\makeatletter
  \newenvironment{subfloat}% % Create the new environment.
    {\def\caption##1{\gdef\subcapsave{\relax##1}}%
     \let\subcapsave=\@empty % Save the subcaption text.
     \let\sf@oldlabel=\label
     \def\label##1{\xdef\sublabsave{\noexpand\label{##1}}}%
     \let\sublabsave\relax    % Save the label key.
     \setbox\subfigbox\hbox
       \bgroup}%              % Open the box...
      {\egroup                % ... close the box and call \subfigure.
     \let\label=\sf@oldlabel
     \subfigure[\subcapsave]{\box\subfigbox}}%
\makeatother

\usetikzlibrary{arrows,decorations.pathmorphing,decorations.markings,backgrounds,positioning,fit,petri,automata,shapes,petri}

\pgfdeclarelayer{bg}
\pgfsetlayers{bg,main}

% MGK recommends these formatting settings:

% for hard-bound final submission, use:
\setlength{\oddsidemargin}{4.6mm}     % 30 mm left margin - 1 in
% for soft-bound version and techreport, use instead:
%\setlength{\oddsidemargin}{-0.4mm}    % 25 mm left margin - 1 in
\setlength{\evensidemargin}{\oddsidemargin}
\setlength{\topmargin}{-5.4mm}        % 20 mm top margin - 1 in
\setlength{\textwidth}{160mm}         % 20/25 mm right margin
\setlength{\textheight}{247mm}        % 20 mm bottom margin
\setlength{\headheight}{5mm}
\setlength{\headsep}{5mm}
\setlength{\parindent}{0mm}
\setlength{\parskip}{\medskipamount}
\renewcommand\baselinestretch{1.2}
\renewcommand\topfraction{.9}
\renewcommand\textfraction{.1}
\renewcommand\floatpagefraction{.8}

\author{Steven Smith}
\title{Chapter 3}

\begin{document}

\tikzset{BddNode/.style={rectangle,minimum size=6mm}}
\tikzset{BddLeaf/.style={rectangle,minimum size=6mm}}
\tikzset{BddTrue/.style={}}
\tikzset{BddFalse/.style={dotted}}

\tikzset{CfgInstr/.style={rectangle,minimum size=6mm}}
\tikzset{TrueCfgInstr/.style={rectangle,minimum size=6mm,fill=blue!50}}
\tikzset{DupeCfgInstr/.style={rectangle,minimum size=6mm,fill=blue!10}}
\tikzset{NewCfgInstr/.style={rectangle,minimum size=6mm,fill=red!50}}
\tikzset{stateSideEffect/.style={rectangle,draw}}
\tikzset{stateIf/.style={ellipse,draw}}
\tikzset{stateTerminal/.style={ellipse,draw}}
\tikzset{flowChartState/.style={rectangle,draw}}
\tikzset{killEdge/.style={decorate,decoration={snake,segment length=1mm,post length=0.4mm}}}
\tikzset{swungEdge/.style={color=red}}
\tikzset{happensBeforeEdge/.style={dashed}}
\tikzset{ifTrue/.style={}}
\tikzset{ifFalse/.style={dotted}}

\newcommand{\draftonly}[1]{#1}
\newcommand{\editorial}[1]{\draftonly{\textcolor{red}{\footnote{\textcolor{red}{#1}}}}}
\newcommand{\smh}[1]{\draftonly{\textcolor{green}{\footnote{\textcolor{green}{#1}}}}}
\newcommand{\needCite}{\draftonly{\editorial{need cite}}}
\newcommand{\todo}[1]{\draftonly{\textcolor{red}{#1}}}

% Used the first time we introduce a new bit of terminology
\newcommand{\introduction}[1]{\textbf{#1}}
% Backrefs to earlier \introductions.  I'm going to remove the colour
% in the final version, but I want it to be a bit more obvious if I
% have backrefs before introductions in the drafts.
\newcommand{\backref}[1]{\textcolor{purple}{#1}}

\newcommand{\needNewTerm}[1]{\textcolor{blue}{#1}}
\newcommand{\StateMachine}{\needNewTerm{banana}}
\newcommand{\StateMachines}{\needNewTerm{bananas}}
\newcommand{\STateMachine}{\needNewTerm{Banana}}
\newcommand{\STateMachines}{\needNewTerm{Bananas}}
\newcommand{\CrashSummary}{\needNewTerm{strawberry}}
\newcommand{\CrashSummaries}{\needNewTerm{strawberries} }
\newcommand{\implementation}{\needNewTerm{grapefruit}}
\newcommand{\Implementation}{\needNewTerm{Grapefruit}}
\newcommand{\technique}{\needNewTerm{aubergine}}
\newcommand{\Technique}{\needNewTerm{Aubergine}}

\newcommand{\mai}[2]{\mathrm{#1}:\mathrm{#2}}
\newcommand{\happensBeforeEdge}{\leftarrowtail}
\newcommand{\happensBefore}[2]{#1 {\happensBeforeEdge} #2}
\newcommand{\controlEdge}[3]{\mathrm{Control}(\mathrm{#1}:\mathrm{#2} \rightarrow \mathrm{#3})}
\newcommand{\entryExpr}[1]{\mathrm{Entry}(#1)}
\newcommand{\smTmp}[1]{\mathrm{tmp#1}}
\newcommand{\smLoad}[1]{\mathrm{Load}(#1)}
\newcommand{\smBadPtr}[1]{\mathrm{BadPtr}(#1)}

\newcommand{\concatDynTraces}{\oplus}
\newcommand{\interleaveDynTraces}{\otimes}
\newcommand{\survive}{\top}
\newcommand{\crash}{\bot}
\newcommand{\queue}[1]{\{#1\}}
\newcommand{\map}[1]{\{#1\}}
\newcommand{\mapIndex}[2]{#1[#2]}
\newcommand{\state}[1]{\textsc{#1}}

\maketitle
\tableofcontents

\input{derive}

\chapter{Foo}
\section{This is a place for all the labels which this chapter depends on}
\label{sect:future_work:generalising}
\label{sect:implementation_hacks:hb_ordering}
\label{sect:implementation_hacks:bdd_ordering}
\label{sect:function_head}
\label{sect:eval:art:simple_toctou}
\label{eval:time_breakdowns}
\label{sect:program_model:call_graph}
\label{sect:eval:analysis_time}
\label{sect:intro:overview}
\label{sect:simplifying}
\label{sect:eval:indexed_toctou}
\label{sect:eval:w_isolation}

\bibliographystyle{plain}
\bibliography{$HOME/mendeley.bib/library}

\end{document}

